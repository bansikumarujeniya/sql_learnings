/* 1 List all orders with customer name and total amount. */

SELECT orders1.id, customers.name, orders1.amount FROM orders1
JOIN customers ON orders1.customer_id = customers.id;

/* 2 Find all products ordered by customers from 'Mumbai'. */

SELECT customers.name,product.name FROM orders1 
JOIN customers ON orders1.customer_id = customers.id  
JOIN orders_details ON orders1.id = orders_details.order_id
JOIN product ON orders_details.product_id = product.id
WHERE customers.city = 'Rajkot';

/* 3 List all salesmen and the number of customers they serve.*/

SELECT salesmans.name,COUNT(customers.id) AS total_customers FROM salesmans
JOIN orders1 ON salesmans.id = orders1.salesman_id
JOIN customers ON customers.id = orders1.customer_id
GROUP By salesmans.name;

/* 4 Get order details including product name, quantity, and total price per item. */

SELECT orders1.id,product.name,orders_details.quantity,product.price * orders_details.quantity AS total_price
FROM orders1
JOIN orders_details ON orders1.id = orders_details.order_id
JOIN product ON orders_details.product_id = product.id;

/* 5 List all customers who haven’t placed any order. */

SELECT customers.name FROM customers 
LEFT JOIN orders1 ON customers.id = orders1.customer_id
WHERE orders1.id IS NULL;

/* 6 Find the total sales made by each salesman. */

SELECT salesmans.name,SUM(orders1.amount) AS total_sales FROM salesmans
JOIN orders1 ON salesmans.id = orders1.salesman_id
GROUP BY salesmans.name;

/* 7 Calculate total quantity sold per product. */

SELECT product.name,SUM(orders_details.quantity) AS total_quantity
FROM product
JOIN orders_details ON product.id = orders_details.product_id 
GROUP BY product.name;

/* 8 Find the top 5 customers based on total purchase amount. */

SELECT customers.name, SUM(orders1.amount) AS total_spent FROM customers
JOIN orders1 ON customers.id = orders1.customer_id
GROUP BY customers.name ORDER BY total_spent DESC
LIMIT 5;

/* 9 Get the average order value for each region. */

SELECT customers.city,AVG(orders1.amount) AS avg_order FROM orders1
JOIN customers ON orders1.customer_id = customers.id
GROUP BY customers.city;

/* 10 List salesmen with total sales above ₹1,00,000. */

SELECT salesmans.name,SUM(orders1.amount) AS total_sales FROM salesmans
JOIN orders1 ON salesmans.id = orders1.salesman_id GROUP BY salesmans.name
HAVING SUM(orders1.amount) > 100000;

/* 11 Find customers who ordered products from the 'Electronics' category. */

SELECT DISTINCT customers.name FROM orders1 
JOIN customers ON orders1.customer_id = customers.id
JOIN orders_details ON orders1.id = orders_details.order_id
JOIN product ON orders_details.product_id = product.id
WHERE product.category = 'Electronics';

/* 12 List all orders where the total amount is greater than the average order amount. */

SELECT * FROM orders1 WHERE amount > (SELECT AVG(amount) FROM orders1); 

/* 13 Get products that were never ordered. */

SELECT name FROM product WHERE id NOT IN (SELECT product_id FROM orders_details)

/* 14 Find customers who placed more than 3 orders. */

SELECT customers.name,COUNT(orders1.id) AS total_orders FROM customers
JOIN orders1 ON customers.id = orders1.customer_id
GROUP BY customers.name
HAVING COUNT(orders1.id) > 3;

/* 15 List the most expensive product sold in each category. */

SELECT product.category,product.name,product.price FROM product
JOIN(SELECT category,MAX(price) AS max_price FROM product GROUP BY category) AS max_products
ON product.category = max_products.category AND product.price = max_products.max_price;

/* 16 Find salesmen who sold products in more than one city. */

SELECT salesmans.name FROM salesmans
JOIN orders1 ON salesmans.id = orders1.salesman_id
JOIN customers ON orders1.customer_id = customers.id
GROUP BY salesmans.name
HAVING COUNT(DISTINCT customers.city) > 1;

/* 17 Get the total revenue generated by each product. */

SELECT product.name, SUM(orders_details.quantity * product.price) AS revenue FROM product
JOIN orders_details ON product.id = orders_details.product_id
GROUP BY product.name;

/* 18 List products that were only sold by a single salesman. */

SELECT product.name FROM orders_details 
JOIN orders1 ON orders_details.order_id = orders1.id
JOIN product ON orders_details.product_id = product.id
GROUP BY product.name
HAVING COUNT(orders1.salesman_id) = 1;

/* 19 Get all customers who placed orders in the last 30 days. */

SELECT DISTINCT customers.name FROM orders1 
JOIN customers ON orders1.customer_id = customers.id
WHERE orders1.date >=  CURRENT_DATE-30;

/* 20 Find the salesman with the highest commission earned from total sales. */

SELECT salesmans.name, SUM(orders1.amount * salesmans.commision / 100) AS total_commission FROM salesmans
JOIN orders1 ON salesmans.id = orders1.salesman_id
GROUP BY salesmans.name
ORDER BY total_commission DESC
Limit 1;

































